<%= render "shared/auth_navbar" %>

<section class="logged-in-user-profile">
  <%= cl_image_tag(@user.avatar.key, width: 200, crop: :scale) %>
  <h3><%= capitalize_string(@user.full_name) %></h3>
  <span style="color:grey;">Following(<%= @user.following.count %>) | Followers(<%= @user.followers.count %>)</span>
  <hr>
  <p><%= @user.bio %></p>
  <% if current_user != @user && current_user %>
    <% if current_user.following?(@user) %>
      <%= link_to "Unfollow", relationship_path(current_user.active_relationships.find_by(followed_id: @user.id)), data: { turbo_method: :delete } %>
    <% else %>
      <%= form_with(model: current_user.active_relationships.build, local: true) do |form| %>
        <div><%= hidden_field_tag :followed_id, @user.id %></div>
        <%= form.submit "Follow" %>
      <% end %>
    <% end %>
  <% end %>

  <% if current_user == @user %>
    <%= link_to "Edit Account â†—", edit_user_registration_path %>
    <br/>
    <br/>
    <section class="logged-in-user-section">
        <%= button_to "Logout", destroy_user_session_path, data: {turbo: "false"}, method: :delete %>
    </section>
  <% end %>
  <br/>
  <br/>
  <br/>
  <% if @publications.length > 0 %>
    <%= render "publications/publications", publications: @publications %>
  <% else %>
    <h4>No publications yet. <%= link_to "Get started!", new_publication_path %></h4>
  <% end %>
</section>

<%= render "layouts/footer" %>